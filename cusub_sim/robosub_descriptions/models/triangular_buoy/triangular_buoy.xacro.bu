<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro"
  name="triangular_buoy">

<!-- Loading file with sensor macros -->
<xacro:include filename="$(find uuv_sensor_ros_plugins)/urdf/sensor_snippets.xacro"/>

<xacro:macro name="triangular_buoy" params="namespace">

  <link name="${namespace}/base_link">
      <inertial>
        <origin
          xyz="0.0 0.0 0.0"
          rpy="0 0 0" />
        <mass
          value="0.5" />
        <inertia
          ixx="1.0E-5"
          ixy="0.0"
          ixz="0.0"
          iyy="1.0E-5"
          iyz="0.0"
          izz="1.0E-5" />
      </inertial>
      <visual>
        <origin
          xyz="0 0 0"
	  rpy="0 0 0" />
        <geometry>
        <mesh
          filename="package://robosub_descriptions/models/triangular_buoy/triangular_buoy.dae" />
        </geometry>
      </visual>
      <collision>
        <origin
          xyz="0 0 0"
	  rpy="0 0 0" />
        <geometry>
        <mesh
          filename="package://robosub_descriptions/models/triangular_buoy/triangular_buoy.dae" />
        </geometry>
      </collision>
  </link>
  <xacro:default_pose_3d namespace="${namespace}" parent_link="${namespace}/base_link" />
  <link name = "${namespace}/string_link">
  <inertial>
    <origin
      xyz="0 0 -0.6"
      rpy="0 0 0" />
    <mass
      value="0.05" />
    <inertia
      ixx="0.00014047076006077"
      ixy="3.28827308175579E-18"
      ixz="-1.89307007035867E-17"
      iyy="0.00014047076006077"
      iyz="-7.70371977754894E-34"
      izz="0.00014047076006077" />
  </inertial>
  </link>
  <link name = "${namespace}/anchor_link">
    <inertial>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <mass
        value="2.0" />
      <inertia
        ixx="0.014047076006077"
        ixy="3.28827308175579E-18"
        ixz="-1.89307007035867E-17"
        iyy="0.014047076006077"
        iyz="-7.70371977754894E-34"
        izz="0.014047076006077" />
    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <box size="0.1 0.1 0.1"/>
      </geometry>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <box size="0.1 0.1 0.1"/>
      </geometry>
    </collision>
  </link>
  <joint name="${namespace}/base_joint" type="continuous">
    <origin
      xyz="0.0 0.0 -0.6"
      rpy="0 0 0" />
    <parent link="${namespace}/base_link"/>
    <child link="${namespace}/string_link"/>

    <axis xyz="0 1 0" />
    <dynamics damping="1.0" friction="1.0"/>
    <limit effort="1000.0" velocity="10.0" />

  </joint>
  <joint name="${namespace}/anchor_joint" type="continuous">
    <origin
      xyz="0 0 -2.0"
      rpy="0 0 0" />
    <parent link="${namespace}/string_link"/>
    <child link="${namespace}/anchor_link"/>
    <axis xyz="0 1 0" />
    <dynamics damping="100.0" friction="100.0"/>
    <limit effort="1000.0" velocity="10.0" />

  </joint>

  <transmission name="${namespace}/buoy_transmission">
    <type>transmission_interface/SimpleTransmission</type>
      <joint name="${namespace}/base_joint">
        <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
      </joint>
      <actuator name="${namespace}/buoy_servo">
        <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
  </transmission>

  <gazebo>

    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
      <robotNamespace>/buoy_spin_1</robotNamespace>
    </plugin>

    <plugin filename="libuuv_underwater_object_ros_plugin.so" name="uuv_plugin">
    <fluid_density>1028.0</fluid_density>
    <flow_velocity_topic>hydrodynamics/current_velocity</flow_velocity_topic>
    <debug>0</debug>
    <link name="${namespace}/base_link">
        <fluid_density>1028</fluid_density>
        <flow_velocity_topic>hydrodynamics/current_velocity</flow_velocity_topic>
        <neutrally_buoyant>0</neutrally_buoyant>
        <volume>0.001</volume>

        <box>
          <width>0.1</width>
          <length>0.1</length>
          <height>0.1</height>
        </box>

        <!-- Center of buoyancy -->
        <center_of_buoyancy>0 0 0.5 </center_of_buoyancy>

        <hydrodynamic_model>
          <type>sphere</type>
          <radius>0.1</radius>
        </hydrodynamic_model>
      </link>
    </plugin>

  </gazebo>

</xacro:macro>

<xacro:triangular_buoy namespace="$(arg namespace)"/>

</robot>
